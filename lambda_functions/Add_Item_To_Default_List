import json
import boto3
from botocore.exceptions import ClientError

dynamodb = boto3.resource('dynamodb')
table = dynamodb.Table('property')

def lambda_handler(event, context):
    user_name = event['user_name']
    item_name = event['item_name']  # No encryption needed for item name

    try:
        # Add the item to the default list
        response = table.get_item(Key={'user_name': user_name})
        if "Item" not in response:
            return {
                "statusCode": 404,
                "body": json.dumps({"error": "User not found"})
            }

        user_data = response["Item"]
        default_items = user_data.get("default_list", [])

        if item_name in default_items:
            return {
                "statusCode": 400,
                "body": json.dumps({"error": "Item already exists in the default list"})
            }

        # Add the item name to the default list (store in plain text)
        default_items.append(item_name)
        user_data["default_list"] = default_items
        table.put_item(Item=user_data)

        return {
            "statusCode": 200,
            "body": json.dumps({"message": "Item added to default list"})
        }
    except Exception as e:
        return {
            "statusCode": 500,
            "body": json.dumps({"error": str(e)})
        }
